//@ui5-bundle emlatracker/csvupload/Component-preload.js
sap.ui.predefine("emlatracker/csvupload/Component", ["sap/ui/core/UIComponent","sap/m/App"],function(t,e){"use strict";return t.extend("emlatracker.csvupload.Component",{metadata:{manifest:"json"},init:function(){t.prototype.init.apply(this,arguments);var e=this.getModel();if(e){this.setModel(e)}this.getRouter().initialize()},createContent:function(){return new e({id:"app"})}})});
sap.ui.predefine("emlatracker/csvupload/ext/main/Main.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageBox"],function(e,r){"use strict";return e.extend("emlatracker.csvupload.ext.main.Main",{onInit:function(){this._selectedFile=null;this._updateUploadButtonState()},onFileChange:function(e){var r=e.getParameter("files")&&e.getParameter("files")[0];this._selectedFile=r||null;if(r)this._showMessage("File selected: "+r.name,"Information");this._updateUploadButtonState()},onCsvTypeChange:function(){this._updateUploadButtonState()},_updateUploadButtonState:function(){var e=this.byId("csvTypeRadio");var r=e&&typeof e.getSelectedIndex==="function"&&e.getSelectedIndex()!==-1;this.byId("uploadButton").setEnabled(!!this._selectedFile&&r)},onUploadPress:function(){if(!this._selectedFile){this._showMessage("Please select a CSV file first.","Error");return}var e=this.byId("csvTypeRadio");var r=e&&typeof e.getSelectedIndex==="function"?e.getSelectedIndex():-1;var t=r===0?"integration":r===1?"public":null;if(!t){this._showMessage("Please choose a CSV type","Error");return}var n=this;var o=new FileReader;o.onload=function(e){n.byId("uploadButton").setEnabled(false);n._uploadViaHTTP(e.target.result,t)};o.onerror=function(e){console.error("File read error",e);n._showMessage("Failed to read file","Error")};o.readAsText(this._selectedFile,"UTF-8")},_uploadViaHTTP:function(e,r){var t=this.getView().getModel();if(!t)return Promise.reject(new Error("No OData model"));var n=this;function o(e){var r=[],t="",n=false;for(var o=0;o<e.length;o++){var s=e[o];if(s==='"'){if(n&&o+1<e.length&&e[o+1]==='"'){t+='"';o++;continue}n=!n;t+=s;continue}if(!n&&(s==="\n"||s==="\r")){if(s==="\r"&&o+1<e.length&&e[o+1]==="\n"){}if(t.trim().length>0)r.push(t);t="";continue}t+=s}if(t.trim().length>0)r.push(t);return r}var s=o(e);if(s.length===0){n._showMessage("CSV file is empty","Error");return Promise.reject(new Error("Empty"))}var a=s[0];var i=s.slice(1);var l=i.length;var d=9e4,u=250;function c(e,r){var t=[],n=[],o=e.length+1,s=o;for(var a=0;a<r.length;a++){var i=r[a],l=i.length+1;if(n.length>0&&(s+l>d||n.length>=u)){t.push(e+"\n"+n.join("\n"));n=[];s=o}if(l+o>d&&n.length===0){t.push(e+"\n"+i);continue}n.push(i);s+=l}if(n.length>0)t.push(e+"\n"+n.join("\n"));return t}var p=c(a,i);p.forEach(function(e,r){console.log("Prepared batch",r+1,"/",p.length,"size="+e.length+" bytes")});n._showMessage("Processing "+l+" rows in "+p.length+" batches...","Information");var h={inserted:0,updated:0,updateErrors:0,errors:[],failedRowsCsv:"",skippedNoAdvisor:0,validationErrors:0,dbErrors:0,advisorUnresolved:0};var f=0;function v(e){if(e>=p.length){n._handleUploadResponse(h);return Promise.resolve(h)}f=e+1;n._showMessage("Batch "+f+" of "+p.length+" - uploading...","Information");return new Promise(function(n,o){try{var s=t.bindContext("/uploadCSV(...)",undefined,{groupId:"$direct"});s.setParameter("csvData",p[e]);if(r)s.setParameter("csvType",r);s.execute().then(function(){try{var e=s.getBoundContext().getObject();var r;if(e&&typeof e.value==="string"){try{r=JSON.parse(e.value)}catch(t){r={message:e.value,inserted:0,errors:[]}}}else if(e&&e.value){r=e.value}else{r=e}h.inserted+=r.inserted||0;h.updated+=r.updated||0;h.updateErrors+=r.updateErrors||0;h.skippedNoAdvisor+=r.skippedNoAdvisor||0;h.validationErrors+=r.validationErrors||0;h.dbErrors+=r.dbErrors||0;h.advisorUnresolved+=r.advisorNotFoundCount||0;if(r.errors&&r.errors.length)h.errors=h.errors.concat(r.errors);if(r.failedRowsCsv)h.failedRowsCsv+=r.failedRowsCsv+"\n";n()}catch(e){console.error("Parse response error",e);o(e)}}).catch(function(e){console.error("Action error batch "+f,e);o(e)})}catch(e){console.error("Config action error",e);o(e)}}).then(function(){return v(e+1)})}return v(0).catch(function(e){var r="Upload failed";if(e&&e.message)r+=": "+e.message;n._showMessage(r,"Error");if(h.inserted>0||h.errors.length>0)n._handleUploadResponse(h);return Promise.reject(e)})},_handleUploadResponse:function(e){var r=e&&(e.inserted||e.insertedCount||0)||0;var t=e&&e.updated||0;var n=e&&e.updateErrors||0;var o=e&&e.errors||[];var s=e&&e.failedRowsCsv;var a=e&&e.skippedNoAdvisor||0;var i=e&&(e.advisorUnresolved||e.advisorNotFoundCount)||0;this._showMessage("Upload finished. Inserted: "+r+", Updated: "+t+", Errors: "+o.length+(a?", Skipped (no advisor): "+a:"")+(i?", Advisor unresolved: "+i:"")+(n?", UpdateErrors: "+n:""),"Success");var l=this;var d=[new sap.m.Text({text:"Inserted: "+r}),new sap.m.Text({text:"Updated: "+t}),new sap.m.Text({text:"Errors: "+o.length}),n?new sap.m.Text({text:"Update Errors: "+n}):null,a?new sap.m.Text({text:"Skipped (no advisor): "+a}):null,i?new sap.m.Text({text:"Advisor Unresolved: "+i}):null].filter(Boolean);if(o.length===0){d.push(new sap.m.Text({text:"No errors encountered."}))}var u=new sap.m.VBox({items:d});var c=null;if(o.length){c=new sap.m.Table({headerText:"Error Details",columns:[new sap.m.Column({header:new sap.m.Label({text:"Row"})}),new sap.m.Column({header:new sap.m.Label({text:"Reason"})}),new sap.m.Column({header:new sap.m.Label({text:"Raw"})})]});o.forEach(function(e){var r="";try{r=e.raw?JSON.stringify(e.raw):e.record?JSON.stringify(e.record):""}catch(e){r=""}c.addItem(new sap.m.ColumnListItem({cells:[new sap.m.Text({text:e.row!=null?e.row:""}),new sap.m.Text({text:e.reason||e.__dbError||""}),new sap.m.Text({text:r})]}))})}var p=[u];if(c)p.push(c);var h=new sap.m.Dialog({title:"Upload Result",contentWidth:"70%",content:p,beginButton:new sap.m.Button({text:"Close",press:function(){h.close()}}),endButton:new sap.m.Button({text:"Download Errors",type:"Emphasized",press:function(){if(!o.length){l._showMessage("No errors to download","Information");return}var e="";if(s){e=s}else{e="row,reason,raw\n";o.forEach(function(r){var t="";try{t=r.raw?JSON.stringify(r.raw):r.record?JSON.stringify(r.record):""}catch(e){t=""}e+=(r.row||"")+","+'"'+(r.reason||r.__dbError||"").replace(/"/g,'""')+'"'+","+'"'+t.replace(/"/g,'""')+'"'+"\n"})}var r=new Blob([e],{type:"text/csv;charset=utf-8;"});var t=URL.createObjectURL(r);var n=document.createElement("a");n.href=t;n.download="upload-errors.csv";document.body.appendChild(n);n.click();document.body.removeChild(n);URL.revokeObjectURL(t)}}),afterClose:function(){h.destroy()}});h.open()},_showMessage:function(e,r){var t=this.byId("messageStrip");if(!t)return;t.setText(e);t.setType(r||"Information");t.setVisible(true)}})});
sap.ui.require.preload({
	"emlatracker/csvupload/Component-preload.js":function(){
sap.ui.predefine("emlatracker/csvupload/Component-preload",[],function(){"use strict";return{}});
},
	"emlatracker/csvupload/ext/main/Main.view.xml":'<mvc:View xmlns:core="sap.ui.core" xmlns:mvc="sap.ui.core.mvc" xmlns="sap.m" xmlns:macros="sap.fe.macros"\n    xmlns:html="http://www.w3.org/1999/xhtml" xmlns:u="sap.ui.unified" controllerName="emlatracker.csvupload.ext.main.Main"><Page id="Main" title="EMLA CSV Upload"><content><VBox id="mainContainer" class="sapUiMediumMargin"><Panel id="uploadPanel" headerText="CSV Upload for EMLA Customers" class="sapUiResponsiveMargin" width="auto"><content><VBox id="contentContainer" class="sapUiMediumMargin"><MessageStrip id="messageStrip" visible="false" class="sapUiMediumMarginBottom"/><Label id="fileLabel" text="Select CSV File:" class="sapUiTinyMarginBottom"/><u:FileUploader id="fileUploader" \n                                name="csvFile" \n                                uploadUrl="" \n                                tooltip="Upload CSV file"\n                                fileType="csv,txt" \n                                maximumFileSize="10"\n                                placeholder="Choose CSV file..." \n                                change="onFileChange"\n                                class="sapUiMediumMarginBottom"/><VBox id="optionsContainer" class="sapUiTinyMarginTop"><Label id="configLabel" text="CSV Configuration:" class="sapUiTinyMarginBottom"/><HBox id="csvTypeContainer" class="sapUiTinyMarginBottom"><Label id="csvTypeLabel" text="CSV Type:" class="sapUiTinyMarginEnd" required="true"/><RadioButtonGroup id="csvTypeRadio" select="onCsvTypeChange"><RadioButton id="rbIntegration" text="Integration Suite" /><RadioButton id="rbPublic" text="Public ERP" /></RadioButtonGroup></HBox><HBox id="delimiterContainer" class="sapUiTinyMarginBottom"><Label id="delimiterLabel" text="Delimiter:" class="sapUiTinyMarginEnd"/><Select id="delimiterSelect" selectedKey="," width="100px"><core:Item id="delimiterComma" key="," text="Comma (,)"/><core:Item id="delimiterSemicolon" key=";" text="Semicolon (;)"/><core:Item id="delimiterPipe" key="|" text="Pipe (|)"/><core:Item id="delimiterTab" key="tab" text="Tab"/></Select></HBox><CheckBox id="hasHeaderCheckBox" text="File has header row" selected="true"/></VBox><HBox id="buttonContainer" class="sapUiMediumMarginTop"><Button id="uploadButton" \n                                    text="Upload CSV" \n                                    type="Emphasized" \n                                    press="onUploadPress" \n                                    enabled="false"\n                                    class="sapUiTinyMarginEnd"/><Button id="clearButton" text="Clear" press="onClearPress" type="Default"/></HBox><VBox id="formatContainer" class="sapUiMediumMarginTop"><Label id="formatLabel" text="CSV Format Information:" class="sapUiTinyMarginBottom"/><FormattedText id="formatText" htmlText="&lt;strong&gt;Integration Suite CSV:&lt;/strong&gt;&lt;br/&gt;\n                                Required: customerName, customerNumber, emlaType, region, country&lt;br/&gt;\n                                Optional: startDate, erpOnbAdvNome, btpOnbAdvNome, btpOnbAdvEmail&lt;br/&gt;&lt;br/&gt;\n                                &lt;strong&gt;Public ERP CSV:&lt;/strong&gt;&lt;br/&gt;\n                                Required: customerName, customerNumber, emlaType&lt;br/&gt;\n                                Optional: region, country, startDate, erpOnbAdvNome, btpOnbAdvNome, btpOnbAdvEmail&lt;br/&gt;&lt;br/&gt;\n                                &lt;strong&gt;Date format:&lt;/strong&gt; YYYY-MM-DD&lt;br/&gt;\n                                &lt;strong&gt;File formats:&lt;/strong&gt; .csv, .txt&lt;br/&gt;\n                                &lt;strong&gt;Delimiters:&lt;/strong&gt; Comma, Semicolon, Pipe, Tab"/><VBox id="sampleContainer" class="sapUiTinyMarginTop"><Label id="sampleLabel" text="Sample CSV (Integration Suite):" class="sapUiTinyMarginBottom" design="Bold"/><Text id="sampleHeader" text=\'customerName,customerNumber,emlaType,region,country,startDate,erpOnbAdvNome,btpOnbAdvNome,btpOnbAdvEmail\' \n                                          class="sapUiTinyText"/><Text id="sampleData" text=\'"SAP Brazil","12345","Rise with SAP","LATAM","Brazil","2024-01-15","John Silva","Maria Santos","maria.santos@sap.com"\' \n                                          class="sapUiTinyText"/></VBox></VBox></VBox></content></Panel></VBox></content></Page></mvc:View>',
	"emlatracker/csvupload/i18n/i18n.properties":'# This is the resource bundle for emlatracker.csvupload\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=CSV Upload\n\n#YDES: Application description\nappDescription=Upload csv with emla data\n#XTIT: Custom view title\nMainTitle=EMLA CSV Upload\n\n#XFLD,30\nemlatrackercsvupload-display.flpTitle=CSV Upload\n',
	"emlatracker/csvupload/i18n/i18n_en.properties":'# This is the resource bundle for emlatracker.csvupload\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=CSV Upload\n\n#YDES: Application description\nappDescription=Upload csv with emla data\n#XTIT: Custom view title\nMainTitle=EMLA CSV Upload\n\n#XFLD,30\nemlatrackercsvupload-display.flpTitle=CSV Upload',
	"emlatracker/csvupload/i18n/i18n_en_US.properties":'# This is the resource bundle for emlatracker.csvupload\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=CSV Upload\n\n#YDES: Application description\nappDescription=Upload csv with emla data\n#XTIT: Custom view title\nMainTitle=EMLA CSV Upload\n\n#XFLD,30\nemlatrackercsvupload-display.flpTitle=CSV Upload',
	"emlatracker/csvupload/manifest.json":'{"_version":"1.60.0","sap.app":{"id":"emlatracker.csvupload","type":"application","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":["","en","en-US"]},"applicationVersion":{"version":"0.0.10"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:fpm","version":"1.19.1","toolsId":"5b6fa7ee-809a-4f96-b798-5816aee55f8c"},"dataSources":{"mainService":{"uri":"service/EMLATrackerService/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}}},"crossNavigation":{"inbounds":{"emlatrackercsvupload-display":{"semanticObject":"emlatrackercsvupload","action":"display","title":"{{emlatrackercsvupload-display.flpTitle}}","signature":{"parameters":{},"additionalParameters":"allowed"}}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.108.0","libs":{"sap.m":{},"sap.ui.core":{},"sap.ui.unified":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"emlatracker.csvupload.i18n.i18n","supportedLocales":["","en","en-US"]}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}},"@i18n":{"type":"sap.ui.model.resource.ResourceModel","uri":"i18n/i18n.properties","settings":{"supportedLocales":["","en","en-US"]}}},"resources":{"css":[]},"routing":{"config":{"routerClass":"sap.m.routing.Router","viewType":"XML","controlId":"app","controlAggregation":"pages"},"routes":[{"pattern":"","name":"main","target":"main"}],"targets":{"main":{"viewId":"main","viewName":"emlatracker.csvupload.ext.main.Main"}}}},"sap.cloud":{"public":true,"service":"lcap.EMLATracker"},"sap.platform.cf":{"oAuthScopes":["uaa.user"]}}'
});
//# sourceMappingURL=Component-preload.js.map
